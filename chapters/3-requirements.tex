\chapter{Requirements}

The requirements are developed in a collaborative fashion, between Jonas, Snorre, Mariusz and Abylay, during the weekly technical supervisor meeting.



\section{Non-functional Requirements}
\begin{itemize}
    \item The application needs to have a CLI.
    \item No GUI.
    \item Developed in the Rust programming language.
    \item Use existing Rust libraries wherever possible.
    \item Only support one DIDComm transport - stdin/stdout
    \item Only support one DID-method - did-key
    \item Only support one cryptographic-method - x25519/ed25519
\end{itemize}



\section{Functional Requirements Writing Style}

The functional requirement are written with User-Stories as titles and with BDD-style tests as descriptions. BDD-style tests are written in a way that is easy to translate to a code-test. The BDD-style tests are also easy for a human to follow, if a human wants to do a manual test. For an introduction to BDD (Behaviour Driven Development), read Dan North's original post about BDD here: https://dannorth.net/introducing-bdd/.

\paragraph{}
BDD makes the bridge between requirements, implementation and testing as small as possible, saving time later in the development process. It also makes the gap between technical and non-technical team-members as small as possible, making it possible to iterate on the requirements faster. The people developing requirements may have a wide range of technical skill. BDD is about talking in a "common-denominator" that everyone can understand, and at the same is easy to implement.



\section{Functional Requirement Layers}

The functional requirements are grouped together in 4 groups. Each group represents a layer in the SSI-stack.
\begin{description}
    \item[Layer 1:] DID 
    \item[Layer 2:] DIDComm
    \item[Layer 3:] Verifiable Credentials
    \item[Layer 4:] Application (Scenario)
\end{description}


\newpage

\section{Functional Requirements Layer 1 - DID}


\subsection{As a user I want to create an agent inside a directory on my machine}
\begin{description}\begin{description}
    \item[Given] I am in an empty directory
    \item[When] I run \texttt{did init}
    \item[Then] an agent should be created in the directory
    \item[and] all the agent's files should be stored in the sub-directory .did/, like .git/
    \item[and] the agent's DID should be written to stdout 
    \item[and] a the DIDName \texttt{self} should be linked to the DID
    \item[and] the directory is now of the type "agent-directory".
\end{description}\end{description}


\subsection{As a user I want to view an agent's DID}
\begin{description}\begin{description}
    \item[Given] I am in an agent-directory
    \item[When] I run \texttt{did init}
    \item[or] I run \texttt{did did self}
    \item[Then] the agent's DID should be written to \texttt{stdout}.
\end{description}\end{description}


\subsection{As a user I want to view an agent's DID document}
\begin{description}\begin{description}
    \item[Given] I am in an agent-directory
    \item[When] I run \texttt{did doc}
    \item[Then] the agent's DID-document should be written to \texttt{stdout} as prettified JSON.
\end{description}\end{description}


\subsection{As a user I want to connect a name to a DID}
\begin{description}\begin{description}
    \item[Given] I am in an agent-directory
    \item[and] I have a DID \texttt{did:key:z6MkjidGmTqu3jG73hVdz5MKEGtVLCLof9ctxTXHMomNcivxA}
    \item[When] I run \texttt{did connect doctor did:key:z6MkjidGmTqu3jG73hVdz5MKEGtVLCLof9ctxTXHMomNcivx}
    \item[Then] the name \texttt{doctor} should be stored in the agent
    \item[and] I should be able to use \texttt{doctor} in other commands, instead of typing the whole underlying DID.
    \item[and] the name \texttt{doctor} should be written to \texttt{stdout}, to enable chaining together commands.
\end{description}\end{description}


\subsection{As a user I want to refer to an agent's DID by using the name self}
\begin{description}\begin{description}
    \item[Given] I am in an agent-directory
    \item[When] I run any command. Example: \texttt{did write self hello}
    \item[Then] I should be able to refer to the agents own DID by the name \textt{self}.
\end{description}\end{description}


\subsection{As a user I want to view all my DID's}
\begin{description}\begin{description}
    \item[Given] I am in an agent-directory
    \item[and] I there are some DIDNames stored in the agent
    \item[When] I run \texttt{did dids}
    \item[Then] a list of all the agent's DIDNames should be written to `stdout`.
\end{description}\end{description}


\subsection{As a user I want to view a DIDName's DID}
\begin{description}\begin{description}
    \item[Given] I am in an agent-directory
    \item[and] the agent has a DIDName \texttt{police}
    \item[When] I run \texttt{did did police}
    \item[Then] the DID of \texttt{police} should be written to \texttt{stdout}.
\end{description}\end{description}


\newpage

\section{Functional Requirements Layer 2 - DIDComm}

\subsection{As a user I want to write a DCEM from one agent to another}
\begin{description}\begin{description}
    \item[Given] I have two agents on my machine
    \item[and] I am in one of the agent-directories
    \item[and] I have stored the DID of the other agent by the name \texttt{other}
    \item[When] I run \texttt{did write other hello}, with the contents "Hello".
    \item[Then] a DCEM should be written to \texttt{stdout}
    \item[and] the DCEM should be addressed to \texttt{other}. 
\end{description}\end{description}

For more info on DCEM - DIDComm Encrypted Message - see: https://identity.foundation/didcomm-messaging/spec/#didcomm-encrypted-message.



\subsection{As a user I want to read the contents of a DCEM addressed to an agent}
\begin{description}\begin{description}
    \item[Given] I am in an agent-directory
    \item[and] I receive a DCEM-file - \texttt{hello.dcem} - addressed to my agent
    \item[When] I run \texttt{did read \$(cat hello.dcem)} 
    \item[or] I run \texttt{cat hello.dcem | did read}
    \item[Then] the plaintext contents of the DCEM should be written to \texttt{stdout}.
\end{description}\end{description}



\subsection{As a user I want to hold a DCEM inside an agent}
\begin{description}\begin{description}
    \item[Given] I am in an agent-directory
    \item[and] I receive a DCEM-file - \texttt{hello.dcem} - addressed to my agent
    \item[When] I run \texttt{did hold \$(cat hello.dcem)} 
    \item[or] I run \texttt{cat hello.dcem | did hold}
    \item[Then] the DCEM should be stored inside my agent with the id of the DCEM
    \item[and] the DCEM should be written to `stdout`.
\end{description}\end{description}

Note: If an existing DCEM has id=4, and a new DCEM also has id=4, then new DCEM should overwrite the one already held by the agent.



\subsection{As a user I want to view a list of all DCEMs an agent is holding}
\begin{description}\begin{description}
    \item[Given] I am in an agent-directory
    \item[and] the agent is holding multiple DCEMs
    \item[When] I run \texttt{did messages}
    \item[Then] a list of all agent's DCEM-ids, should be written to \texttt{stdout}.
\end{description}\end{description}



\subsection{As a user I want to view a single DCEM an agent is holding}
\begin{description}\begin{description}
    \item[Given] I am in an agent-directory
    \item[and] there is a DCEM with id \texttt{7497036273686508746}, held by the agent
    \item[When] I run \texttt{did message 7497036273686508746}
    \item[Then] the DCEM should be written to \texttt{stdout}.
\end{description}\end{description}



\newpage



\section{Functional Requirements Layer 3 - Verifiable Credentials}



\subsection{As an issuer I want to issue a Verifiable Credential to a subject}
\begin{description}\begin{description}
    \item[Given] I am in an agent-directory
    \item[and] the agent has connected a DID to the name \texttt{bob}
    \item[When] I run \texttt{did issue Passport bob}
    \item[Then] a DCEM with a Verifiable Credential of type \texttt{Passport}, with \texttt{vc.subject.did} of \texttt{bob}, and with \texttt{vc.issuer.did} of \texttt{self}, should be written to \texttt{stdout}.
\end{description}\end{description}



\subsection{As a holder I want to present a Verifiable presentation to a verifier}
\begin{description}\begin{description}
    \item[Given] I am in an agent-directory
    \item[and] the agent has connected a DID to the name \texttt{police}
    \item[and] the agent is holding a Verifiable Credential as a DCEM with id 1234
    \item[When] I run \texttt{did message 1234 | did present police}
    \item[or] I run \texttt{did present Passport police \$(did message 1234)}
    \item[Then] a DCEM with a Verifiable Presentation of type \texttt{Passport}, containing the Verifiable Credential from \texttt{did message 1234}, with \texttt{vp.holder.did} of \texttt{self}, should be written to \texttt{stdout}.
\end{description}\end{description}



\subsection{As a verifier I want to verify a Verifiable Presentation}
\begin{description}\begin{description}
    \item[Given] I am in an agent-directory
    \item[and] and the agent has connected a DID to the name \texttt{jonny}
    \item[and] and the agent has connected a DID to the name \texttt{police}
    \item[and] I have a file with a Verifiable Presentation of type \texttt{Passport}, stored as \texttt{passport.vp.dcem}
    \item[When] I run \texttt{cat passport.vp.dcem | did verify Passport police jonny}
    \item[or] I run \texttt{did verify Passport police jonny \$(cat passport.vp.dcem)}
    \item[and] it succeeds
    \item[And] I can trust that the\texttt{vp.type} is \texttt{Passport}
    \item[Then] I can trust that the \texttt{vp.vc.issuer.did} is \textt{police}
    \item[And] I can trust that the \texttt{vp.vc.subject.did} is \texttt{jonny}
    \item[And] I the file \texttt{passport.vp.dcem} will be written to \texttt{stdout}.
\end{description}\end{description}



\newpage



\section{Functional Requirements Layer 4 - Scenario}

\subsection{As a citizen I want to publish my DID to a file}

```
GIVEN I have an agent
WHEN  I run `did init > self.did`
OR    I run `did did self > self.did`
THEN  a file with the name `self.did` should contain my DID.
```

\subsection{As governemnt I want to connect my citizens DIDs to names}

```
GIVEN my citizens each have their own agents
AND   each citizens has published their DIDs as files: `snorre.did`, `abylay.did`, `jonas.did`
WHEN  I run `cat jonas.did | did connect jonas`
AND   I run `cat abylay.did | did connect abylay`
AND   I run `cat snorre.did | did snorre snorre`
THEN  I should be able to refer to my citizens DIDnames `jonas`,`abylay` and `snorre`, in other commands.
```

\subsection{As a citizen I want to connect to my governemnt DID}

```
GIVEN my governemnt has a DID published as `government.did`
WHEN  I run `cat governemnt.did | did connect government`
THEN  I should be able to refer to the name `government` in other commands.
```

\subsection{As government I want issue Passports to my citizens as files}

```
GIVEN I have stored the DIDnames of my citizens
WHEN  I run `did issue Passport jonas > jonas.passport.vc.dcem`
AND   I run `did issue Passport abylay > abylay.passport.vc.dcem`
AND   I run `did issue Passport snorre > snorre.passport.vc.dcem`
THEN  my citizens passports should be stored as files that can be shared
AND   the files can only be read by their intended recipient.
```

\subsection{As a citizen I want to hold Passports issued to me}

```
GIVEN my governemnt has issued a Passport to in a file `jonas.passport.vc.dcem`
WHEN  I run `cat jonas.passport.vc.dcem | did hold`
THEN  the Passport is stored in my agent as a DCEM
AND   and the DCEM can be later refered to by the DCEM.id
AND   the DCEM can be looked up by using `did messages`.
```

\subsection{As a citizen I want to view my Passport in plaintext}

```
GIVEN I have am holding a Passport as a DCEM with id 340340032
WHEN  I run `did message 340340032 | did read`
THEN  my Passport should be written to `stdout` in cleartext.
```

\subsection{As a citizen I want to present my Passport to the Police}

```
GIVEN I have am holding a Passport as a DCEM with id 340340032
AND   I have connected a DID to the DIDName `police`
WHEN  I run `did message 340340032 | did present police > jonas.passport.vp.dcem`
THEN  my Passport should be stored in a file
AND   it should only be able to be viewed and verified by the `police`.
```

\subsection{As the Police I want to verify a Passport from a citizen I am controlling}

```
GIVEN I have approached a citizen which has a agent
AND   the citizens DID is stored in my agent with name `jonas`
AND   the governments DID is stored in my agent with name `government`
AND   the citizen present his passport to me as the file `jonas.passport.vp.dcem`
WHEN  I run `cat jonas.passport.vp.dcem | did verify government jonas Passport`
THEN  I can be sure that the Passport is valid, and issued by the `government`.
```
